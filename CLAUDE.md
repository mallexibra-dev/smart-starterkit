# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Smart Starterkit is a clean, modern monorepo template built with Bun, featuring a React frontend with TanStack Router and a Hono backend with PostgreSQL database and Drizzle ORM. The project uses TypeScript throughout and follows a modular architecture with shared types and utilities. This is a **starterkit template** - clean and ready for you to build your features on top.

## Common Development Commands

### Root Level Commands
```bash
# Start all services (client + server) in development mode
bun run dev

# Start individual services
bun run dev:client    # Frontend at http://localhost:5173
bun run dev:server    # Backend at http://localhost:3000

# Build all packages
bun run build

# Build individual packages
bun run build:client
bun run build:server

# Code quality
bun run lint          # ESLint all packages
bun run type-check    # TypeScript type checking
bun run test          # Run tests (if configured)
```

### Client-Specific Commands
```bash
cd client
bun run dev           # Vite dev server with hot reload
bun run build         # Production build (TypeScript + Vite)
bun run preview       # Preview production build locally
bun run lint          # ESLint
```

### Server-Specific Commands
```bash
cd server
bun run dev           # Bun watch mode with hot reload
bun run build         # TypeScript compilation
```

## Architecture Overview

### Monorepo Structure
- **client/**: React 19 + Vite frontend with TanStack Router
- **server/**: Hono API backend with PostgreSQL database and Drizzle ORM
- **shared/**: Shared TypeScript types and utilities
- Uses Bun workspaces for dependency management
- Turbo for build orchestration and caching

### Frontend Architecture (client/)
- **Framework**: React 19 with TypeScript
- **Routing**: TanStack Router with file-based routing in `src/routes/`
- **State Management**: TanStack Query for server state
- **UI**: shadcn/ui components built on Radix UI + Tailwind CSS
- **Forms**: React Hook Form with Zod validation
- **HTTP Client**: Axios with proxy configuration to backend

#### Key Frontend Patterns
- Route components are auto-generated by TanStack Router plugin
- Components are organized in:
  - `src/components/ui/` - shadcn/ui base components
  - `src/components/blocks/` - Reusable feature components (combinations of shadcn-ui)
  - `src/components/layout/` - Layout components
  - `src/routes/{page}/-components/` - Page-specific components only
- Services in `src/services/` handle API communication with axios
- Types are imported from shared workspace: `"shared": "workspace:*"`
- Validation uses Zod schemas from `shared/src/validation`

### Backend Architecture (server/)
- **Framework**: Hono with OpenAPI integration and Swagger documentation
- **Database**: PostgreSQL with Drizzle ORM, connection pooling, and Winston logging
- **Validation**: Zod schemas for request/response validation
- **Structure**: MVC pattern with routes, controllers, services, and schemas

#### Backend File Organization
```
server/src/
├── route/          # API route definitions with Swagger docs (e.g., user.route.ts)
├── controller/     # Request handlers receiving params and using services
├── service/        # Business logic (e.g., user.service.ts)
├── schemas/        # Zod validation schemas for Swagger documentation
├── middlewares/    # Custom middleware
└── utils/          # Utility functions and helpers
```

### Database Setup
- Database schema with basic user management in `server/database/query.sql`
- Connection configuration in `server/utils/db.ts`
- Supports soft deletes with `deleted_at` columns
- Raw SQL queries (no ORM) with Winston logging

## Development Workflow

### Adding New Features
1. **Check existing structure**: Review database schema in `server/database/query.sql`, existing types in `shared/src/types`, and validation in `shared/src/validation`
2. **Backend API**: Create route → controller → service → schema files
3. **Frontend**: Add route component in `client/src/routes/`
4. **Shared Types**: Add shared types in `shared/src/types/` and validation in `shared/src/validation/`
5. **Services**: Create service functions in `client/src/services/` using axios
6. **Navigation**: Update AppSidebar.tsx if creating new routes

### File Naming Conventions
- Types: `{name}.type.ts`
- Validation: `{name}.validation.ts`
- Service: `{name}.service.ts`
- Schema: `{name}.schema.ts`
- Controller: `{name}.controller.ts`

### Route Pattern Examples
- **Frontend**: File-based routing with nested routes
  - `users.tsx` → `/users`
  - `users.$id.tsx` → `/users/:id`
  - `users.edit.$id.tsx` → `/users/:id/edit`
  - `users.create.tsx` → `/users/create`
  - General pattern: `/{resource}/{id}/{action}`

- **Backend**: RESTful API routes
  - `GET /api/users` - List users
  - `POST /api/users` - Create user
  - `PUT /api/users/:id` - Update user
  - `DELETE /api/users/:id` - Delete user

### Validation Error Handling
- Map validation errors from API responses to form fields
- Display field-specific errors below corresponding inputs
- Show validation error messages from backend (not generic strings)
- Convert Zod error responses to user-friendly field errors
- Use proper error state management for form validation

### Package Management
- Use workspace references: `"shared": "workspace:*"`
- Install dependencies in respective workspace directories
- Root workspace automatically installs all dependencies with `bun install`

### Environment Configuration
- **Client**: `.env.local` with `VITE_` prefixed variables
- **Server**: `.env.local` with database and API configuration
- **Proxy**: Vite proxies `/api/*` requests to backend server

## Important Technical Details

### TypeScript Configuration
- Root `tsconfig.json` for workspace configuration
- Individual `tsconfig.json` files in each workspace
- Strict type checking enabled

### Build System
- Turbo orchestrates builds with dependency management
- Client builds to `dist/` directory
- Server compiles TypeScript to JavaScript in `dist/`
- Shared package builds first as dependency

### Development Server
- Frontend runs on port 5173 (Vite default)
- Backend runs on port 3000 (configurable via env)
- CORS configured for development cross-origin requests

### API Documentation
- OpenAPI/Swagger documentation available at `/api/docs`
- Auto-generated from Hono route definitions

## Testing and Quality

### Linting
- ESLint configuration in `client/eslint.config.js`
- Run with `bun run lint` for all packages

### Type Checking
- Comprehensive TypeScript checking across workspaces
- Run with `bun run type-check`

## Specialized Agents

This project includes specialized Claude agents for specific tasks:

### React Component Architect
- **Trigger phrases**: "Buatkan aku component reusable", "component reusable", "create component", "component architecture"
- **Purpose**: Creates reusable React components in `client/src/components/blocks/`
- **Best practices**: Composition over inheritance, TypeScript prop interfaces, proper accessibility, semantic HTML
- **File structure**: Creates organized component folders with index.ts, ComponentName.tsx, styles, types, and stories

### Feature Page Creator
- **Trigger**: When needing complete feature implementations (frontend + backend)
- **Purpose**: Creates full features including pages, components, and backend APIs
- **Process**: Follows structured approach from database → backend → frontend → validation
- **Deliverables**: Complete backend (service, controller, route, schema), frontend (service, pages, components), and shared types/validation

## Code Quality Standards

- Write clean, readable, and maintainable code
- Follow existing coding patterns and file naming conventions
- Include proper error handling and loading states
- Use appropriate TypeScript types
- Use existing shadcn-ui components when possible
- Place types in `shared/src/types` and validation in `shared/src/validation`

## Common Gotchas

1. **Workspace Dependencies**: Always install dependencies in the correct workspace directory
2. **Route Generation**: Frontend routes are auto-generated - don't manually edit `routeTree.gen.ts`
3. **Database Connection**: Ensure PostgreSQL is running and environment variables are configured
4. **Proxy Configuration**: Frontend API calls work through Vite proxy in development
5. **Build Order**: Turbo handles build dependencies - shared package builds automatically first
6. **Validation Source**: Always use Zod validation from `shared/src/validation` as single source of truth for both client and server